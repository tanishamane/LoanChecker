<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Loan Grant Checker</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --brand-yellow:#ffc400;
      --brand-black:#111111;
      --brand-gray:#f6f6f6;
      --brand-muted:#6b7280;
      --radius: 16px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Roboto,Arial;color:#111;background:#fff;line-height:1.4}
    .container{max-width:1100px;margin:0 auto;padding:0 20px}
    /* Navbar */
    .site-header{background:var(--brand-black);color:#fff;position:sticky;top:0;z-index:10;border-bottom:4px solid var(--brand-yellow);}
    .site-header .container{display:flex;align-items:center;gap:24px;padding:14px 20px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:800}
    .brand .logo{width:36px;height:36px;background:var(--brand-yellow);color:#000;border-radius:10px;display:grid;place-items:center;font-weight:800}
    .nav{display:flex;gap:20px;margin-left:auto}
    .nav a{color:#fff;text-decoration:none;opacity:.9;padding:8px 10px;border-radius:8px;transition:background 0.3s,color 0.3s;}
    .nav a:hover,.nav a.active{background:var(--brand-yellow);color:#111;opacity:1}
    .cta{background:var(--brand-yellow);color:#000;padding:10px 14px;border-radius:12px;text-decoration:none;font-weight:700;margin-left:8px}
    /* Checker */
    .checker{padding:36px 0}
    .checker h2{font-size:28px;margin:0 0 16px}
    .grid.two{display:grid;grid-template-columns:1fr 1fr;gap:16px;align-items:end}
    .field{display:flex;flex-direction:column}
    input{width:100%;padding:12px;border:1px solid #ddd;border-radius:12px;font-size:14px}
    label{font-size:12px;color:#555;display:block;margin:6px 0}
    .btn{background:var(--brand-yellow);border:0;padding:12px 16px;border-radius:12px;font-weight:700;cursor:pointer}
    /* Result */
    .result{display:grid;grid-template-columns:260px 1fr;gap:24px;margin-top:20px}
    .result-card{padding:16px;border:1px solid #eee;border-radius:var(--radius);background:#fff}
    .offers{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-top:10px}
    .offer{background:var(--brand-gray);padding:10px;border-radius:12px}
    /* Gauge */
    .gauge{position:relative;width:260px;height:160px;background:conic-gradient(from 180deg, 
      #c0392b 0deg, #c0392b 36deg, #e67e22 36deg, #e67e22 72deg, #f1c40f 72deg, #f1c40f 126deg, #2ecc71 126deg, #2ecc71 180deg);
      border-bottom-left-radius:260px;border-bottom-right-radius:260px;overflow:hidden;border:1px solid #eee}
    .gauge-needle{position:absolute;bottom:0;left:50%;width:2px;height:140px;background:#111;transform-origin:bottom center;transform:translateX(-50%) rotate(90deg)}
    .gauge-score{position:absolute;bottom:8px;left:0;right:0;text-align:center;font-weight:800;font-size:22px}
    .gauge-bands{position:absolute;bottom:0;left:0;right:0;display:flex;justify-content:space-between;padding:0 8px 6px;font-size:11px;color:#333}
    .hidden{display:none}
    
    /* Modal styles for login */
    #loginModal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0; top: 0;
      width: 100%; height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
    }
    #loginModalContent {
      background: white;
      padding: 2rem;
      border-radius: 12px;
      max-width: 400px;
      width: 90%;
      box-shadow: 0 8px 16px rgba(0,0,0,0.25);
    }
    #loginModalContent h2 {
      margin-top: 0;
      margin-bottom: 1rem;
    }
  </style>
</head>
<body>
  <!-- ✅ Navbar -->
  <header class="site-header">
    <div class="container">
      <div class="brand"><div class="logo">LC</div><div class="title">Loan Checker</div></div>
      <nav class="nav">
        <a href="index.html" class="active">Home</a>
        <a href="#" id="checkScoreLink">Check Score</a>
        <a href="calculator.html">Calculators</a>
        <a href="blog.html">Blog</a>
        <a href="faq.html">FAQs</a>
        <a href="about.html">About</a>
        <a href="#" id="loginNavLink">Login</a>
      </nav>
      <a class="cta" href="#check">Check Now</a>
    </div>
  </header>


  <!-- Loan Checker Section -->
  <main class="container">
    <section id="check" class="checker">
      <h2>Loan Eligibility & Score</h2>
      <form id="checkForm" class="grid two hidden">
        <div class="field"><label>Full Name</label><input id="name" required></div>
        <div class="field"><label>Monthly Income (₹)</label><input id="income" type="number" min="0" required></div>
        <div class="field"><label>Existing EMIs (₹)</label><input id="emi" type="number" min="0" value="0"></div>
        <div class="field"><label>Credit History (months)</label><input id="history" type="number" min="0" value="0"></div>
        <div class="field"><label>Late Payments (last 12m)</label><input id="delinq" type="number" min="0" value="0"></div>
        <div class="field"><label>Utilization (%)</label><input id="util" type="number" min="0" max="100" value="0"></div>
        <div class="field"><label>Requested Amount (₹)</label><input id="requested" type="number" min="0" value="0"></div>
        <button class="btn" type="submit">Get Result</button>
      </form>

      <div id="result" class="result hidden">
        <div class="gauge">
          <div class="gauge-needle" id="gaugeNeedle"></div>
          <div class="gauge-score" id="scoreText">--</div>
          <div class="gauge-bands"><span>300</span><span>500</span><span>650</span><span>730</span><span>800</span><span>900</span></div>
        </div>
        <div class="result-card">
          <h3 id="decision">—</h3>
          <p id="reasoning" class="muted"></p>
          <div class="offers">
            <div class="offer"><strong>Eligibility:</strong> <span id="eligible"></span></div>
            <div class="offer"><strong>Max Amount:</strong> ₹<span id="maxAmt"></span></div>
            <div class="offer"><strong>Indicative ROI:</strong> <span id="roi"></span>%</div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Login Modal -->
  <div id="loginModal">
    <div id="loginModalContent">
      <h2>Please Log In</h2>
      <form id="loginForm">
        <div class="field">
          <label>Email</label>
          <input type="email" id="loginEmail" placeholder="Enter your email" required>
        </div>
        <div class="field">
          <label>Password</label>
          <input type="password" id="loginPassword" placeholder="Enter your password" required>
        </div>
        <button type="submit" class="btn btn-primary">Login</button>
        <p id="loginMsg" class="muted"></p>
      </form>
    </div>
  </div>

  <script>
    const $ = id => document.getElementById(id);

    const checkScoreLink = $("checkScoreLink");
    const loginNavLink = $("loginNavLink");
    const loginModal = $("loginModal");
    const loginForm = $("loginForm");
    const loginMsg = $("loginMsg");
    const checkForm = $("checkForm");
    const resultDiv = $("result");

    // Simple in-memory "database" for demo (use your backend in production)
    const users = JSON.parse(localStorage.getItem("users") || "{}");
    let loggedInUser = localStorage.getItem("loggedInUser") || null;

    // Update UI according to logged-in state
    function updateLoginUI(){
      if(loggedInUser){
        loginNavLink.textContent = "Logout";
        checkForm.classList.remove("hidden");
      } else {
        loginNavLink.textContent = "Login";
        checkForm.classList.add("hidden");
        resultDiv.classList.add("hidden");
      }
    }
    updateLoginUI();

    // Show login modal
    function showLoginModal(){
      loginMsg.textContent = "";
      loginModal.style.display = "flex";
    }

    // Hide login modal
    function hideLoginModal(){
      loginModal.style.display = "none";
    }

    // Clicking Check Score link
    checkScoreLink.addEventListener("click", (e)=>{
      e.preventDefault();
      if(!loggedInUser){
        showLoginModal();
      } else {
        checkForm.scrollIntoView({behavior:"smooth"});
      }
    });

    // Clicking Logout/Login nav link
    loginNavLink.addEventListener("click", e => {
      e.preventDefault();
      if(loggedInUser){
        // logout
        loggedInUser = null;
        localStorage.removeItem("loggedInUser");
        updateLoginUI();
        alert("Logged out successfully.");
      } else {
        // show login modal
        showLoginModal();
      }
    });

    // Login form submit
    loginForm.addEventListener("submit", e => {
      e.preventDefault();
      loginMsg.textContent = "";
      const email = $("loginEmail").value.trim().toLowerCase();
      const password = $("loginPassword").value;

      if(!users[email]){
        loginMsg.textContent = "Email not registered.";
        return;
      }
      if(users[email].password !== password){
        loginMsg.textContent = "Incorrect password.";
        return;
      }

      loggedInUser = email;
      localStorage.setItem("loggedInUser", email);
      hideLoginModal();
      updateLoginUI();
      alert("Login successful! You can now check your score.");
      checkForm.scrollIntoView({behavior:"smooth"});
    });

    // Score calculation function
    function calculateResult(values){
      let score = 300;

      score += Math.min(values.income / 500, 250);        // income weight
      score -= Math.min(values.emi / 500, 100);            // EMI penalty
      score += Math.min((values.history / 12) * 15, 120); // credit history
      score -= values.delinq * 25;                         // late payments
      score -= values.util * 0.6;                          // utilization penalty

      score = Math.max(300, Math.min(900, Math.round(score)));

      let band = (score>=750)?"Excellent":(score>=650)?"Good":(score>=500)?"Fair":"Poor";
      let decision = score>=650 ? "Likely Approved" : "Needs Improvement";

      let eligible = (score>=650 && values.income>20000 && values.history>=12 && values.util<=60 && values.delinq<=2);
      let maxAmt = eligible ? Math.min(values.income * 20 - values.emi * 12, values.requested) : 0;
      let roi = eligible ? (score>=750?11:(score>=650?14:17)) : "--";

      let reasons = [];
      if(values.income < 20000) reasons.push("low income");
      if(values.history < 12) reasons.push("short credit history");
      if(values.util > 60) reasons.push("high credit utilization");
      if(values.delinq > 2) reasons.push("multiple late payments");
      if(values.emi > values.income*0.4) reasons.push("heavy EMI burden");
      if(score < 500) reasons.push("overall weak credit profile");

      let reasoning = reasons.length ? "Score is low due to " + reasons.join(", ") + "." : 
                                      "Based on income, credit history, utilization & late payments.";

      return {score, decision, band, eligible, maxAmt, roi, reasoning};
    }

    // Handle score form submission
    checkForm.addEventListener("submit", e=>{
      e.preventDefault();
      const data = {
        name:$("name").value.trim(),
        income:+$("income").value,
        emi:+$("emi").value,
        history:+$("history").value,
        delinq:+$("delinq").value,
        util:+$("util").value,
        requested:+$("requested").value
      };
      let res = calculateResult(data);

      resultDiv.classList.remove("hidden");
      $("scoreText").textContent=res.score;
      $("decision").textContent=`${res.band} • ${res.decision}`;
      $("reasoning").textContent=res.reasoning;
      $("eligible").textContent=res.eligible?"Eligible":"Not Eligible";
      $("maxAmt").textContent=new Intl.NumberFormat('en-IN').format(res.maxAmt);
      $("roi").textContent=res.roi;

      const deg=180-((res.score-300)/600)*180;
      document.querySelector("#gaugeNeedle").style.transform=`translateX(-50%) rotate(${deg}deg)`;
      location.hash="#result";
    });
  </script>
  <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getAuth } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
  import { getFirestore, setDoc, doc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyANP-eQh83GzWoBuE2tGirmSQXwpeT3utc",
    authDomain: "credit-score-checker-78666.firebaseapp.com",
    projectId: "credit-score-checker-78666",
    storageBucket: "credit-score-checker-78666.appspot.com",
    messagingSenderId: "933140507068",
    appId: "1:933140507068:web:80ece2fd3f80097ea763b9",
    measurementId: "G-KDGPN9XV5H"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  async function saveUserData() {
    const user = auth.currentUser;
    if (!user) {
      alert("❌ Please login first!");
      window.location.href = "login.html";
      return;
    }

    const input = document.getElementById("userInput").value;
    const result = "Processed result for: " + input;

    try {
      await setDoc(doc(db, "userData", user.uid), {
        input: input,
        result: result,
        createdAt: serverTimestamp()
      });
      alert("✅ Data saved!");
    } catch (error) {
      alert("❌ " + error.message);
    }
  }

  document.getElementById("saveBtn").addEventListener("click", saveUserData);
</script>

</body>
</html>
